<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1.0" name="viewport"/>
    <title>College Readiness Check • LPL Prototype</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
      tailwind.config = {
        theme: {
          extend: {
            colors: {
              lpl: {
                navy: '#0B1F3B',
                blue: '#1F5AA6',
                sky: '#EAF1FB',
                ink: '#0F172A',
                slate: '#64748B',
                border: '#E2E8F0'
              },
              status: {
                good: '#0F6B3E',
                warn: '#C47F00',
                bad:  '#8A1C2B'
              }
            }
          }
        }
      }
    </script>
</head>
<body class="bg-slate-50 min-h-screen flex flex-col items-center py-12 px-6">
    <div class="w-full max-w-3xl bg-white rounded-2xl shadow-sm ring-1 ring-lpl-border overflow-hidden">
        <div class="bg-lpl-navy p-6 text-white">
            <div class="flex items-center justify-between gap-6">
                <div>
                    <p class="text-xs tracking-wide uppercase text-white/70">LPL University • College Fund Planner</p>
                    <h1 class="text-3xl font-semibold mt-1">LPL College Readiness Check</h1>
                    <p class="mt-1 text-white/80 text-sm">Personalized guidance with real-time AI coaching.</p>
                </div>
                <div class="hidden sm:flex items-center gap-2">
                    <span class="px-2 py-1 rounded-md bg-white/10 text-xs font-semibold">powered by AWS Bedrock</span>
                </div>
            </div>
        </div>

        <div class="p-8">
            <form class="grid grid-cols-1 md:grid-cols-2 gap-6" id="savingsForm">
                <div>
                    <label class="block text-sm font-semibold text-gray-700">Student's Age</label>
                    <input class="w-full mt-1 p-3 border rounded-lg focus:ring-2 focus:ring-lpl-blue outline-none" id="age" placeholder="e.g. 5" required type="number"/>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700">Current 529 Balance ($)</label>
                    <input class="w-full mt-1 p-3 border rounded-lg focus:ring-2 focus:ring-lpl-blue outline-none" id="savings" placeholder="5000" required type="text"/>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700">Monthly Contribution ($)</label>
                    <input class="w-full mt-1 p-3 border rounded-lg focus:ring-2 focus:ring-lpl-blue outline-none" id="monthly" placeholder="200" required type="text"/>
                </div>
                <div>
                    <label class="block text-sm font-semibold text-gray-700">Target College</label>
                    <select class="w-full mt-1 p-3 border rounded-lg focus:ring-2 focus:ring-lpl-blue outline-none" id="collegeType">
                        <option value="inState">In-State Public ($12k/yr)</option>
                        <option value="outOfState">Out-of-State Public ($28k/yr)</option>
                        <option value="private">Private University ($45k/yr)</option>
                    </select>
                </div>
                <div class="md:col-span-2">
                    <label class="block text-sm font-semibold text-gray-700">Investment Style</label>
                    <select class="w-full mt-1 p-3 border rounded-lg focus:ring-2 focus:ring-lpl-blue outline-none" id="riskStyle">
                        <option value="conservative">Conservative (Low Risk / 4% Return)</option>
                        <option selected value="balanced">Balanced (Moderate Risk / 6% Return)</option>
                        <option value="growth">Growth (High Risk / 8% Return)</option>
                    </select>
                </div>
                <button class="md:col-span-2 bg-lpl-blue text-white font-semibold py-3.5 rounded-xl hover:brightness-95 transition active:scale-[0.99]" type="submit">
                    Check My College Plan
                </button>
            </form>

            <div class="hidden mt-8 text-center" id="loading">
                <div class="animate-spin rounded-full h-10 w-10 border-b-2 border-lpl-blue mx-auto"></div>
                <p class="mt-2 text-gray-600 italic">Generating advisor-style guidance…</p>
            </div>

            <div class="hidden mt-8" id="results">
                <div class="rounded-2xl ring-1 ring-lpl-border bg-white p-6 mb-8">
                    <div class="flex items-start justify-between gap-4">
                        <h3 class="text-lg font-semibold text-lpl-ink">Your Projection</h3>
                        <div class="shrink-0 px-3 py-1 rounded-full text-xs font-semibold ring-1" id="statusBadge"></div>
                    </div>
                    <div class="mt-5 grid grid-cols-1 sm:grid-cols-3 gap-3">
                        <div class="rounded-xl bg-slate-50 p-4 ring-1 ring-lpl-border text-center">
                            <p class="text-[10px] uppercase tracking-wider text-slate-500">Projected Tuition</p>
                            <p class="mt-1 text-xl font-bold text-lpl-ink" id="tuitionOut">$—</p>
                        </div>
                        <div class="rounded-xl bg-slate-50 p-4 ring-1 ring-lpl-border text-center">
                            <p class="text-[10px] uppercase tracking-wider text-slate-500">Projected Savings</p>
                            <p class="mt-1 text-xl font-bold text-lpl-ink" id="savingsOut">$—</p>
                        </div>
                        <div class="rounded-xl bg-slate-50 p-4 ring-1 ring-lpl-border text-center">
                            <p class="text-[10px] uppercase tracking-wider text-slate-500">Funding Gap</p>
                            <p class="mt-1 text-xl font-bold text-lpl-ink" id="gapOut">$—</p>
                        </div>
                    </div>
                    
                    <div class="mt-6 rounded-xl bg-lpl-sky p-5 border-l-4 border-lpl-blue">
                        <p class="text-xs uppercase font-bold text-lpl-blue">Initial Advisor Insight</p>
                        <p class="mt-2 text-slate-800 text-sm leading-relaxed" id="aiResponse"></p>
                    </div>
                </div>

                <div class="border-t border-lpl-border pt-8">
                    <h3 class="text-lg font-semibold text-lpl-ink flex items-center gap-2">
                        <span class="w-2 h-2 rounded-full bg-green-500 animate-pulse"></span>
                        Ask your AI Coach a Question
                    </h3>
                    <p class="text-sm text-slate-500 mb-4">"How can I bridge this $50k gap?" or "Should I save more monthly?"</p>
                    
                    <div id="chatHistory" class="space-y-4 max-h-64 overflow-y-auto mb-4 p-2 bg-slate-50 rounded-lg border border-lpl-border hidden">
                        </div>

                    <form id="chatForm" class="flex gap-2">
                        <input type="text" id="chatInput" placeholder="Type your follow-up question..." 
                               class="flex-1 p-3 border rounded-xl focus:ring-2 focus:ring-lpl-blue outline-none text-sm"/>
                        <button type="submit" class="bg-lpl-navy text-white px-6 py-3 rounded-xl font-semibold text-sm hover:bg-lpl-blue transition">
                            Send
                        </button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script>
        const form = document.getElementById('savingsForm');
        const chatForm = document.getElementById('chatForm');
        const resultsDiv = document.getElementById('results');
        const loadingDiv = document.getElementById('loading');
        const aiResponseText = document.getElementById('aiResponse');
        const chatHistory = document.getElementById('chatHistory');
        const chatInput = document.getElementById('chatInput');

        const LAMBDA_URL = 'https://yaop7absrkhux7ejxhgch4smni0lhcbs.lambda-url.us-east-1.on.aws/';

        // Helper: Format as USD
        const USD = (n) => new Intl.NumberFormat('en-US', { style: 'currency', currency: 'USD', maximumFractionDigits: 0 }).format(n);

        // Helper: Format badges
        function setBadge(statusLabel) {
            const palette = {
                'On Track': { bg: '#E7F3EC', text: '#0F6B3E', ring: '#BFE1CC' },
                'Slightly Behind': { bg: '#FFF4E5', text: '#8A5A00', ring: '#F3D0A2' },
                'At Risk': { bg: '#F8E9EC', text: '#8A1C2B', ring: '#E7B9C1' }
            };
            const p = palette[statusLabel] || palette['At Risk'];
            statusBadge.style.backgroundColor = p.bg;
            statusBadge.style.color = p.text;
            statusBadge.style.borderColor = p.ring;
            statusBadge.textContent = statusLabel;
            statusBadge.className = 'shrink-0 px-3 py-1 rounded-full text-xs font-semibold ring-1';
        }

        // 1. MAIN CALCULATOR SUBMIT
        form.addEventListener('submit', async (e) => {
    e.preventDefault();
    loadingDiv.classList.remove('hidden');
    resultsDiv.classList.add('hidden');

    const payload = {
        age: document.getElementById('age').value,
        savings: document.getElementById('savings').value.replace(/[^0-9]/g, ''),
        monthly: document.getElementById('monthly').value.replace(/[^0-9]/g, ''),
        collegeType: document.getElementById('collegeType').value,
        riskStyle: document.getElementById('riskStyle').value
    };

    try {
        const response = await fetch(LAMBDA_URL, {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify(payload)
        });

        if (!response.ok) {
            throw new Error(`HTTP error! status: ${response.status}`);
        }

        const data = await response.json();

        // Update Numeric UI with actual Lambda response
        document.getElementById('tuitionOut').textContent = USD(data.totalFutureCost);
        document.getElementById('savingsOut').textContent = USD(data.projectedSavings);
        document.getElementById('gapOut').textContent = USD(data.totalFutureCost - data.projectedSavings);

        // Update AI response (if applicable)
        aiResponseText.textContent = data.message || "Calculation complete.";

        // Set badge based on funding gap
        const fundingGap = data.totalFutureCost - data.projectedSavings;
        if (fundingGap <= 0) {
            setBadge("On Track");
        } else if (fundingGap <= 50000) {
            setBadge("Slightly Behind");
        } else {
            setBadge("At Risk");
        }

        loadingDiv.classList.add('hidden');
        resultsDiv.classList.remove('hidden');
    } catch (error) {
        console.error("Error fetching data from Lambda:", error);
        loadingDiv.classList.add('hidden');
        alert("An error occurred while processing your request. Please try again.");
    }
});

        // 2. CHAT BOX LOGIC
        chatForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            const message = chatInput.value.trim();
            if (!message) return;

            // Add user message to UI
            appendMessage('user', message);
            chatInput.value = '';
            chatHistory.classList.remove('hidden');

            try {
                // We send the message as a "monthly" override or custom field 
                // for the Lambda to treat as a conversational follow-up
                const response = await fetch(LAMBDA_URL, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ 
                        message: message,
                        isChat: true,
                        sessionId: 'hackathon-session-123' 
                    })
                });
                const data = await response.json();
                appendMessage('ai', data.answer);
            } catch (error) {
                appendMessage('ai', "I'm having trouble connecting right now. Please try again!");
            }
        });

        function appendMessage(sender, text) {
            const div = document.createElement('div');
            div.className = sender === 'user' ? 'text-right' : 'text-left';
            const span = document.createElement('span');
            span.className = `inline-block p-3 rounded-2xl text-sm ${sender === 'user' ? 'bg-lpl-blue text-white rounded-tr-none' : 'bg-white border border-lpl-border text-slate-800 rounded-tl-none'}`;
            span.textContent = text;
            div.appendChild(span);
            chatHistory.appendChild(div);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }
        
        function parseNumber(v) { return Number(v.replace(/[^0-9]/g, '')) || 0; }
    </script>
</body>
</html>
